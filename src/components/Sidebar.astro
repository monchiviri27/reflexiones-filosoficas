---
import { Calendar, User, Tag, TrendingUp, BookOpen } from 'lucide-astro';
import { getCollection } from 'astro:content';

// Obtener datos para el sidebar
const obrasRecientes = (await getCollection('obras'))
  .filter(o => o.data.publicado)
  .sort((a, b) => new Date(b.data.fecha).getTime() - new Date(a.data.fecha).getTime())
  .slice(0, 5);

const temas = await getCollection('temas');
const temasPopulares = temas.slice(0, 10);
---

<aside class="space-y-8">
  <!-- Buscador -->
  <div class="bg-white p-6 rounded-lg shadow-sm border">
    <h3 class="font-display font-semibold text-lg text-filosofia-primario mb-4 flex items-center gap-2">
      <BookOpen size={20} />
      Buscar obra
    </h3>
    <form class="relative">
      <input 
        type="text" 
        placeholder="T√≠tulo, autor o tema..." 
        class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-filosofia-acento"
      />
      <button 
        type="submit"
        class="absolute right-2 top-2 text-gray-400 hover:text-filosofia-acento"
      >
        üîç
      </button>
    </form>
  </div>
  
  <!-- Obras recientes -->
  <div class="bg-white p-6 rounded-lg shadow-sm border">
    <h3 class="font-display font-semibold text-lg text-filosofia-primario mb-4 flex items-center gap-2">
      <Calendar size={20} />
      Obras recientes
    </h3>
    <ul class="space-y-3">
      {obrasRecientes.map(obra => (
        <li>
          <a 
            href={`/obras/${obra.id}`}
            class="group flex items-start gap-3 p-2 rounded hover:bg-gray-50 transition-colors"
          >
            <div class="flex-shrink-0 mt-1">
              {obra.data.tipo === 'poema' ? 'üìú' : 
               obra.data.tipo === 'cuento' ? 'üìñ' : 
               obra.data.tipo === 'ensayo' ? '‚úçÔ∏è' : '‚ö°'}
            </div>
            <div class="flex-1 min-w-0">
              <h4 class="font-medium text-gray-800 group-hover:text-filosofia-acento truncate">
                {obra.data.titulo}
              </h4>
              <p class="text-sm text-gray-500">
                {obra.data.autor}
              </p>
            </div>
          </a>
        </li>
      ))}
    </ul>
  </div>
  
  <!-- Temas populares -->
  <div class="bg-white p-6 rounded-lg shadow-sm border">
    <h3 class="font-display font-semibold text-lg text-filosofia-primario mb-4 flex items-center gap-2">
      <Tag size={20} />
      Temas populares
    </h3>
    <div class="flex flex-wrap gap-2">
      {temasPopulares.map(tema => (
        <a 
          href={`/temas/${tema.id}`}
          class="inline-flex items-center gap-1 bg-gray-100 text-gray-700 text-sm px-3 py-1.5 rounded-full hover:bg-filosofia-acento hover:text-white transition-colors"
        >
          {tema.data.icono}
          <span>{tema.data.titulo.split(' ')[0]}</span>
        </a>
      ))}
    </div>
  </div>
  
  <!-- Estad√≠sticas -->
  <div class="bg-gradient-to-r from-filosofia-primario to-filosofia-acento text-white p-6 rounded-lg">
    <h3 class="font-display font-semibold text-lg mb-4 flex items-center gap-2">
      <TrendingUp size={20} />
      En n√∫meros
    </h3>
    <div class="grid grid-cols-2 gap-4">
      <div class="text-center">
        <div class="text-2xl font-bold">{obrasRecientes.length}+</div>
        <div class="text-sm opacity-90">Obras analizadas</div>
      </div>
      <div class="text-center">
        <div class="text-2xl font-bold">{temas.length}</div>
        <div class="text-sm opacity-90">Temas filos√≥ficos</div>
      </div>
    </div>
  </div>
  
  <!-- Sobre el autor -->
  <div class="bg-white p-6 rounded-lg shadow-sm border">
    <h3 class="font-display font-semibold text-lg text-filosofia-primario mb-4 flex items-center gap-2">
      <User size={20} />
      Sobre este proyecto
    </h3>
    <p class="text-gray-600 text-sm mb-3">
      Este espacio nace de la fascinaci√≥n por la intersecci√≥n entre literatura y filosof√≠a,
      inspirado especialmente por la obra de Borges y otros autores que invitan a pensar m√°s all√° del texto.
    </p>
    <a href="/acerca" class="text-sm text-filosofia-acento hover:underline">
      Conoce m√°s ‚Üí
    </a>
  </div>
</aside>